const _0x2c21=['2083','application/json','1234.abc.com','reduce','vless://','toString','443','once','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','writeFileSync','from','Answer','config.yaml','post','NAME','log','&path=%2F','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','path','length','index.html','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','slice','https://amd64.ssss.nyc.mn/v1','Status','concat','https://arm64.ssss.nyc.mn/v1','connect','readFile','\x20-p\x20','write','8443','crypto','PORT','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','end','data','find','NEZHA_SERVER','send','readUInt8','hex','utf-8','npm\x20download\x20successfully','chmod\x20+x\x20npm','arch','substr','createHash','npm\x20running\x20error:','env','https://dns.google/resolve?name=','utf8','join','UUID','false','text/html','url','WSPATH','decode','createServer','writeHead','error','every','map','sha224','createWriteStream','@cdns.doon.eu.org:443?security=tls&sni=','https://oooo.serv00.net/add-url','isp','test','catch','Server\x20is\x20running\x20on\x20port\x20','1.1.1.1','client_secret:\x20','text/plain','buffer','get','sub','pipe','AUTO_ACCESS','https://amd64.ssss.nyc.mn/agent','stream','SUB_PATH','includes','8.8.4.4'];const _0x5944=function(_0x2c2111,_0x5944fe){_0x2c2111=_0x2c2111-0x0;let _0x450272=_0x2c21[_0x2c2111];return _0x450272;};const os=require('os');const http=require('http');const fs=require('fs');const axios=require('axios');const net=require('net');const path=require(_0x5944('0x12'));const crypto=require(_0x5944('0x20'));const {Buffer}=require(_0x5944('0x4b'));const {exec,execSync}=require('child_process');const {WebSocket,createWebSocketStream}=require('ws');const UUID=process['env'][_0x5944('0x35')]||'d7aa7eb6-da58-40fc-9e05-2b160b7399d6';const NEZHA_SERVER=process['env'][_0x5944('0x26')]||'';const NEZHA_PORT=process['env']['NEZHA_PORT']||'';const NEZHA_KEY=process['env']['NEZHA_KEY']||'';const DOMAIN=process[_0x5944('0x31')]['DOMAIN']||_0x5944('0x2');const AUTO_ACCESS=process['env'][_0x5944('0x4f')]||![];const WSPATH=process['env'][_0x5944('0x39')]||UUID[_0x5944('0x16')](0x0,0x8);const SUB_PATH=process['env'][_0x5944('0x52')]||_0x5944('0x4d');const NAME=process['env'][_0x5944('0xe')]||'';const PORT=process['env'][_0x5944('0x21')]||0xbb8;let ISP='';const GetISP=async()=>{try{const _0x1ff495=await axios[_0x5944('0x4c')]('https://api.ip.sb/geoip');const _0x4db01f=_0x1ff495['data'];ISP=(_0x4db01f['country_code']+'-'+_0x4db01f[_0x5944('0x44')])['replace'](/ /g,'_');}catch(_0x1620f9){ISP='Unknown';}};GetISP();const httpServer=http[_0x5944('0x3b')]((_0x4515c7,_0x563d3e)=>{if(_0x4515c7[_0x5944('0x38')]==='/'){const _0x3ce091=path[_0x5944('0x34')](__dirname,_0x5944('0x14'));fs[_0x5944('0x1c')](_0x3ce091,_0x5944('0x33'),(_0xf8661d,_0x4c56e8)=>{if(_0xf8661d){_0x563d3e[_0x5944('0x3c')](0xc8,{'Content-Type':'text/html'});_0x563d3e[_0x5944('0x23')]('Hello\x20world!');return;}_0x563d3e[_0x5944('0x3c')](0xc8,{'Content-Type':_0x5944('0x37')});_0x563d3e[_0x5944('0x23')](_0x4c56e8);});return;}else if(_0x4515c7[_0x5944('0x38')]==='/'+SUB_PATH){const _0x5cd72f=NAME?NAME+'-'+ISP:ISP;const _0x48596b=_0x5944('0x4')+UUID+'@cdns.doon.eu.org:443?encryption=none&security=tls&sni='+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x5944('0x10')+WSPATH+'#'+_0x5cd72f;const _0x37b45d='trojan://'+UUID+_0x5944('0x42')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x5944('0x10')+WSPATH+'#'+_0x5cd72f;const _0x295299=_0x48596b+'\x0a'+_0x37b45d;const _0x3f51ed=Buffer[_0x5944('0xa')](_0x295299)['toString']('base64');_0x563d3e['writeHead'](0xc8,{'Content-Type':_0x5944('0x4a')});_0x563d3e['end'](_0x3f51ed+'\x0a');}else{_0x563d3e[_0x5944('0x3c')](0x194,{'Content-Type':_0x5944('0x4a')});_0x563d3e[_0x5944('0x23')]('Not\x20Found\x0a');}});const wss=new WebSocket['Server']({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=[_0x5944('0x54'),_0x5944('0x48')];function resolveHost(_0x375bc8){return new Promise((_0xaf2429,_0x3b2fb6)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x5944('0x45')](_0x375bc8)){_0xaf2429(_0x375bc8);return;}let _0x5eb885=0x0;function _0x4e810b(){if(_0x5eb885>=DNS_SERVERS[_0x5944('0x13')]){_0x3b2fb6(new Error('Failed\x20to\x20resolve\x20'+_0x375bc8+'\x20with\x20all\x20DNS\x20servers'));return;}const _0x1b35fb=DNS_SERVERS[_0x5eb885];_0x5eb885++;const _0x251c6b=_0x5944('0x32')+encodeURIComponent(_0x375bc8)+'&type=A';axios[_0x5944('0x4c')](_0x251c6b,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})['then'](_0x464aa1=>{const _0xc48169=_0x464aa1['data'];if(_0xc48169[_0x5944('0x18')]===0x0&&_0xc48169['Answer']&&_0xc48169[_0x5944('0xb')][_0x5944('0x13')]>0x0){const _0x1c638e=_0xc48169['Answer'][_0x5944('0x25')](_0x169232=>_0x169232['type']===0x1);if(_0x1c638e){_0xaf2429(_0x1c638e[_0x5944('0x24')]);return;}}_0x4e810b();})['catch'](_0x5b5b77=>{_0x4e810b();});}_0x4e810b();});}function handleVlessConnection(_0x20e1ea,_0x2ad404){const [_0x458e0b]=_0x2ad404;const _0x40809f=_0x2ad404[_0x5944('0x16')](0x1,0x11);if(!_0x40809f[_0x5944('0x3e')]((_0x3bbc95,_0x519749)=>_0x3bbc95==parseInt(uuid[_0x5944('0x2e')](_0x519749*0x2,0x2),0x10)))return![];let _0x3a9448=_0x2ad404['slice'](0x11,0x12)['readUInt8']()+0x13;const _0xfb8dbc=_0x2ad404[_0x5944('0x16')](_0x3a9448,_0x3a9448+=0x2)['readUInt16BE'](0x0);const _0x463ae9=_0x2ad404['slice'](_0x3a9448,_0x3a9448+=0x1)['readUInt8']();const _0x4d2144=_0x463ae9==0x1?_0x2ad404['slice'](_0x3a9448,_0x3a9448+=0x4)[_0x5944('0x34')]('.'):_0x463ae9==0x2?new TextDecoder()[_0x5944('0x3a')](_0x2ad404['slice'](_0x3a9448+0x1,_0x3a9448+=0x1+_0x2ad404['slice'](_0x3a9448,_0x3a9448+0x1)[_0x5944('0x28')]())):_0x463ae9==0x3?_0x2ad404[_0x5944('0x16')](_0x3a9448,_0x3a9448+=0x10)[_0x5944('0x3')]((_0x49ffc3,_0x3142e5,_0xf0846d,_0x4c9184)=>_0xf0846d%0x2?_0x49ffc3[_0x5944('0x19')](_0x4c9184[_0x5944('0x16')](_0xf0846d-0x1,_0xf0846d+0x1)):_0x49ffc3,[])[_0x5944('0x3f')](_0x21a5bb=>_0x21a5bb['readUInt16BE'](0x0)[_0x5944('0x5')](0x10))['join'](':'):'';_0x20e1ea[_0x5944('0x27')](new Uint8Array([_0x458e0b,0x0]));const _0x48c951=createWebSocketStream(_0x20e1ea);resolveHost(_0x4d2144)['then'](_0x32eb5e=>{net['connect']({'host':_0x32eb5e,'port':_0xfb8dbc},function(){this['write'](_0x2ad404['slice'](_0x3a9448));_0x48c951['on']('error',()=>{})[_0x5944('0x4e')](this)['on']('error',()=>{})['pipe'](_0x48c951);})['on']('error',()=>{});})['catch'](_0x2f1bc0=>{net[_0x5944('0x1b')]({'host':_0x4d2144,'port':_0xfb8dbc},function(){this[_0x5944('0x1e')](_0x2ad404[_0x5944('0x16')](_0x3a9448));_0x48c951['on']('error',()=>{})[_0x5944('0x4e')](this)['on']('error',()=>{})[_0x5944('0x4e')](_0x48c951);})['on'](_0x5944('0x3d'),()=>{});});return!![];}function handleTrojanConnection(_0x17b224,_0x198a7f){try{if(_0x198a7f[_0x5944('0x13')]<0x3a)return![];const _0x62dd8a=_0x198a7f[_0x5944('0x16')](0x0,0x38)['toString']();const _0x3af0b5=[UUID];let _0x54c15c=null;for(const _0x470123 of _0x3af0b5){const _0x5837f8=crypto[_0x5944('0x2f')](_0x5944('0x40'))['update'](_0x470123)['digest'](_0x5944('0x29'));if(_0x5837f8===_0x62dd8a){_0x54c15c=_0x470123;break;}}if(!_0x54c15c)return![];let _0x5eecc5=0x38;if(_0x198a7f[_0x5eecc5]===0xd&&_0x198a7f[_0x5eecc5+0x1]===0xa){_0x5eecc5+=0x2;}const _0x4dd485=_0x198a7f[_0x5eecc5];if(_0x4dd485!==0x1)return![];_0x5eecc5+=0x1;const _0x57c708=_0x198a7f[_0x5eecc5];_0x5eecc5+=0x1;let _0x232d6a,_0x22a09d;if(_0x57c708===0x1){_0x232d6a=_0x198a7f[_0x5944('0x16')](_0x5eecc5,_0x5eecc5+0x4)[_0x5944('0x34')]('.');_0x5eecc5+=0x4;}else if(_0x57c708===0x3){const _0x16d706=_0x198a7f[_0x5eecc5];_0x5eecc5+=0x1;_0x232d6a=_0x198a7f['slice'](_0x5eecc5,_0x5eecc5+_0x16d706)['toString']();_0x5eecc5+=_0x16d706;}else if(_0x57c708===0x4){_0x232d6a=_0x198a7f['slice'](_0x5eecc5,_0x5eecc5+0x10)['reduce']((_0x27b835,_0x391127,_0x4674e2,_0x547824)=>_0x4674e2%0x2?_0x27b835['concat'](_0x547824['slice'](_0x4674e2-0x1,_0x4674e2+0x1)):_0x27b835,[])['map'](_0x1311e6=>_0x1311e6['readUInt16BE'](0x0)[_0x5944('0x5')](0x10))[_0x5944('0x34')](':');_0x5eecc5+=0x10;}else{return![];}_0x22a09d=_0x198a7f['readUInt16BE'](_0x5eecc5);_0x5eecc5+=0x2;if(_0x5eecc5<_0x198a7f['length']&&_0x198a7f[_0x5eecc5]===0xd&&_0x198a7f[_0x5eecc5+0x1]===0xa){_0x5eecc5+=0x2;}const _0xfd286=createWebSocketStream(_0x17b224);resolveHost(_0x232d6a)['then'](_0x20820e=>{net[_0x5944('0x1b')]({'host':_0x20820e,'port':_0x22a09d},function(){if(_0x5eecc5<_0x198a7f[_0x5944('0x13')]){this['write'](_0x198a7f[_0x5944('0x16')](_0x5eecc5));}_0xfd286['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})[_0x5944('0x4e')](_0xfd286);})['on']('error',()=>{});})[_0x5944('0x46')](_0x4d6fde=>{net['connect']({'host':_0x232d6a,'port':_0x22a09d},function(){if(_0x5eecc5<_0x198a7f['length']){this[_0x5944('0x1e')](_0x198a7f['slice'](_0x5eecc5));}_0xfd286['on'](_0x5944('0x3d'),()=>{})['pipe'](this)['on'](_0x5944('0x3d'),()=>{})[_0x5944('0x4e')](_0xfd286);})['on'](_0x5944('0x3d'),()=>{});});return!![];}catch(_0x3d3726){return![];}}wss['on']('connection',(_0x4dfe22,_0x55bac5)=>{const _0x22db46=_0x55bac5[_0x5944('0x38')]||'';_0x4dfe22[_0x5944('0x7')]('message',_0x2c540e=>{if(_0x2c540e['length']>0x11&&_0x2c540e[0x0]===0x0){const _0x530278=_0x2c540e[_0x5944('0x16')](0x1,0x11);const _0x3e3784=_0x530278['every']((_0x402baf,_0x5b5e05)=>_0x402baf==parseInt(uuid['substr'](_0x5b5e05*0x2,0x2),0x10));if(_0x3e3784){if(!handleVlessConnection(_0x4dfe22,_0x2c540e)){_0x4dfe22['close']();}return;}}if(!handleTrojanConnection(_0x4dfe22,_0x2c540e)){_0x4dfe22['close']();}})['on'](_0x5944('0x3d'),()=>{});});const getDownloadUrl=()=>{const _0x5899bb=os[_0x5944('0x2d')]();if(_0x5899bb==='arm'||_0x5899bb==='arm64'||_0x5899bb==='aarch64'){if(!NEZHA_PORT){return _0x5944('0x1a');}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return _0x5944('0x17');}else{return _0x5944('0x50');}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x35358e=getDownloadUrl();const _0x11be84=await axios({'method':'get','url':_0x35358e,'responseType':_0x5944('0x51')});const _0x313756=fs[_0x5944('0x41')]('npm');_0x11be84[_0x5944('0x24')][_0x5944('0x4e')](_0x313756);return new Promise((_0x450e43,_0x505ef9)=>{_0x313756['on']('finish',()=>{console[_0x5944('0xf')](_0x5944('0x2b'));exec(_0x5944('0x2c'),_0x111775=>{if(_0x111775)_0x505ef9(_0x111775);_0x450e43();});});_0x313756['on'](_0x5944('0x3d'),_0x505ef9);});}catch(_0x26c492){throw _0x26c492;}};const runnz=async()=>{try{const _0x135966=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x5944('0x2a')});if(_0x135966['trim']()!==''){console[_0x5944('0xf')]('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x227457){}await downloadFile();let _0x67cb99='';let _0x134f6d=[_0x5944('0x6'),_0x5944('0x1f'),'2096','2087',_0x5944('0x0'),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x1edb2e=_0x134f6d[_0x5944('0x53')](NEZHA_PORT)?'--tls':'';_0x67cb99='setsid\x20nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x5944('0x1d')+NEZHA_KEY+'\x20'+_0x1edb2e+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x4f7759=NEZHA_SERVER[_0x5944('0x53')](':')?NEZHA_SERVER['split'](':')['pop']():'';const _0x28ced0=_0x134f6d[_0x5944('0x53')](_0x4f7759)?'true':_0x5944('0x36');const _0x3781f4=_0x5944('0x49')+NEZHA_KEY+_0x5944('0x15')+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x28ced0+_0x5944('0x11')+UUID;fs[_0x5944('0x9')]('config.yaml',_0x3781f4);}_0x67cb99=_0x5944('0x8');}else{console['log'](_0x5944('0x22'));return;}try{exec(_0x67cb99,{'shell':'/bin/bash'},_0x4bd592=>{if(_0x4bd592)console['error'](_0x5944('0x30'),_0x4bd592);else console['log']('npm\x20is\x20running');});}catch(_0x138edb){console[_0x5944('0x3d')]('error:\x20'+_0x138edb);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x241700='https://'+DOMAIN+'/'+SUB_PATH;try{const _0xf440d2=await axios[_0x5944('0xd')](_0x5944('0x43'),{'url':_0x241700},{'headers':{'Content-Type':_0x5944('0x1')}});console['log']('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x26f537){}}const delFiles=()=>{fs['unlink']('npm',()=>{});fs['unlink'](_0x5944('0xc'),()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console['log'](_0x5944('0x47')+PORT);});
